#  Локальная работа с репозиторием (без frontend'a)

- Клонируйте репозиторий
```
git clone git@github.com:vink-bot/backend.git
```

- Запросите .env файл у разработчиков (разместите в одной директории с Readme)

- Запустите docker локально. Перейдите в директорию с файлом docker-compose.yml и выполните команду
```
docker-compose up --build
```

- Перейдите в контейнер backend (например через локальный докер в визуальном режиме), создайте суперюзера.
```
python manage.py createsuperuser
```

- API (version 1) будет доступен по url:
http://127.0.0.1:8000/api/v1/
- Админка будет доступна по url:
http://127.0.0.1:8000/admin/
- Flower(отслеживание задач celery) будет доступty по url:
http://127.0.0.1:5555

- Логика
Фронт отправляет POST запрос на http://127.0.0.1:8000/gpt/ передает в теле запроса сообщение от пользователя, например
```
{
    "message": "Торгуете?"
}
```
и в Headers передает токен пользователя (токен генерит фронт), например
```
{
    "chat-token": "serw45ge45v45ygv45yb5454"
}
```
- Создается запись в таблице Message с сообщением пользователя и таблице Token(если его ранее не было)
- Фронт получает сразу ответ 201 либо 400. И задача улетает в celery-worker. Там данное сообщение отправляем в yandexGPT и получаем ответ(от yandexGPT). Создается запись в таблице Message с сообщением от GPT.
- Фронт шлет периодически GET запрос на http://127.0.0.1:8000/message/ (в Headers передает токен пользователя).
- По токену достаем все сообщения со status = "0" (меняем на status = "1") и отдаем их фронту в виде
```
{
    "messages": [
        {
            "message": "Могу предложить вам список товаров синего цвета, которые есть на нашем сайте.",
            "date_create": "2024-04-09T06:31:23.609730Z",
            "user": "GPT"
        },
        {
            "message": "Да, мы торгуем такими товарами.",
            "date_create": "2024-04-09T06:32:02.609730Z",
            "user": "GPT"
        }
    ]
}
```
- Так продолжается до тех пор, пока gpt явно не ответит, как бот, в таком случае, сообщение от gpt пользователю не доставляется, а подключается оператор(человек) через тг бота, который получает всю переписку пользователя с gpt.

# Инструкция по работе оператора через телеграмм-бот.
- https://disk.yandex.ru/i/1Km42IVc3MpENg

# Сайт проекта
- http://hackathon.zapto.org/
#### Админка
- логин "admin" пароль "123"
- http://hackathon.zapto.org/admin/

# Демо работы проекта.
- https://disk.yandex.ru/i/oFe1ww9htkyEiA

# Авторы:
- Александр Мальшаков (ТГ @amalshakov, GitHub [amalshakov](https://github.com/amalshakov/))
- Олег Чужмаров  (ТГ @chtiger4, GitHub [floks41](https://github.com/floks41/))

# Ссылка на репозиторий frontend'a:
- https://github.com/vink-bot/frontend